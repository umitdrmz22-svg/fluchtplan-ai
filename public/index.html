
<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>Flucht- und Rettungsplan – AI Ersteller (DIN ISO 23601, ISO 7010)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Browserbasierter Flucht- und Rettungsplan-Ersteller mit CAD-Zeichenbereich, ISO 7010-Symbolen, AI-Unterstützung und Entwurfsverwaltung (KV/D1).">
  <!-- Optional: Turnstile (nur für serverseitige Endpunkte erforderlich) -->
  <!-- <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script> -->
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <header>
    <h1>Flucht- und Rettungsplan – AI Ersteller</h1>
    <p class="subtitle">DIN ISO 23601 konform, ISO 7010 Symbole, CAD‑Zeichnung, Speicherung in KV/D1.</p>
  </header>

  <main>
    <!-- 1) Entwürfe -->
    <section class="panel">
      <h2>1) Entwürfe verwalten</h2>
      <div class="row">
        <div class="tool">
          <label for="draftTitle">Entwurfstitel:</label>
          <input id="draftTitle" type="text" placeholder="z. B. EG - Produktion Nord" />
        </div>
        <div class="tool">
          <button id="saveDraftBtn">Entwurf speichern</button>
          <button id="listDraftsBtn">Entwürfe laden</button>
        </div>
      </div>
      <div id="draftsList" class="code" aria-live="polite"></div>
    </section>

    <!-- 2) Grundriss: Datei laden (opsiyonel) -->
    <section class="panel">
      <h2>2) Grundriss (optional laden)</h2>
      <div class="row">
        <div>
          <label for="floorUpload">Grundriss (SVG/PNG) hochladen:</label>
          <input id="floorUpload" type="file" accept=".svg,.png,.jpg,.jpeg" />
          <button id="loadSample">Demo laden</button>
        </div>
        <div>
          <label for="scaleInput">Maßstab:</label>
          <input id="scaleInput" type="text" value="1:250" />
          <label for="planSize">Ausgabeformat:</label>
          <select id="planSize">
            <option value="A3">A3 (empfohlen)</option>
            <option value="A4">A4 (nur Einzelraum zulässig)</option>
          </select>
          <label for="legendLang">Legende‑Sprache:</label>
          <select id="legendLang">
            <option value="de">Deutsch</option>
            <option value="en">Englisch</option>
          </select>
        </div>
      </div>
      <p class="hint">Hinweis: Wenn kein Grundriss geladen wird, erstellen Sie ihn direkt im CAD‑Bereich (unten) mit Wänden, Türen, Fenstern.</p>
    </section>

    <!-- 3) CAD‑Zeichenbereich -->
    <section class="panel">
      <h2>3) Grundriss zeichnen (CAD‑Modus)</h2>

      <div class="row toolbar">
        <div class="tool">
          <strong>Werkzeug:</strong>
          <button class="toolbtn" data-tool="select" title="Auswählen (V)">Auswahl</button>
          <button class="toolbtn" data-tool="pan" title="Verschieben (Halten+Ziehen)">Verschieben</button>
          <button class="toolbtn" data-tool="wall" title="Wand (W)">Wand</button>
          <button class="toolbtn" data-tool="door" title="Tür (T)">Tür</button>
          <button class="toolbtn" data-tool="window" title="Fenster (F)">Fenster</button>
          <button class="toolbtn" data-tool="rect" title="Raum Rechteck (R)">Raum</button>
          <button class="toolbtn" data-tool="measure" title="Messen (M)">Messen</button>
          <button class="toolbtn danger" data-tool="erase" title="Löschen (Entf)">Löschen</button>
          <button id="undoBtn" title="Rückgängig (Strg+Z)">Rückgängig</button>
        </div>

        <div class="tool">
          <label for="gridSizeMm">Raster (mm):</label>
          <input id="gridSizeMm" type="number" min="50" value="500" step="50" />
          <label><input type="checkbox" id="gridToggle" checked /> Raster anzeigen</label>
          <label><input type="checkbox" id="snapToggle" checked /> Auf Raster fangen</label>
        </div>

        <div class="tool">
          <label for="wallThkMm">Wandstärke (mm):</label>
          <input id="wallThkMm" type="number" min="50" value="240" step="10" />
          <label for="doorWidthMm">Türbreite (mm):</label>
          <input id="doorWidthMm" type="number" min="600" value="1000" step="50" />
          <label for="winWidthMm">Fensterbreite (mm):</label>
          <input id="winWidthMm" type="number" min="600" value="1200" step="50" />
        </div>
      </div>

      <div id="canvasWrapper">
        <svg id="planCanvas" viewBox="0 0 1400 1000" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Plan">
          <rect x="0" y="0" width="1400" height="1000" fill="#ffffff" />
          <g id="floorGroup"></g>
          <g id="drawGrid"></g>
          <g id="drawGroup"></g>
          <g id="symbolsGroup"></g>
          <g id="northGroup"></g>
          <g id="youAreHereGroup"></g>
          <g id="legendGroup"></g>
        </svg>
      </div>
      <div class="hint">Tipp: Wände mit zwei Klicks zeichnen (Start/Ende). Türen/Fenster auf eine Wand klicken; Auswahl mit Klick, Verschieben durch Ziehen, Entfernen durch Doppelklick oder Löschen.</div>
    </section>

    <!-- 4) ISO 7010 Symbole -->
    <section class="panel">
      <h2>4) Symbole (ISO 7010)</h2>
      <p class="subtitle">Echte ISO‑7010‑SVGs in <code>public/assets/icons/</code> (Dateiname = Code, z. B. <code>E001.svg</code>).</p>
      <div class="row">
        <div class="tool">
          <label>Rettungszeichen (E):</label>
          <select id="rescueSignSelect"></select>
          <button id="addRescueSign">Hinzufügen</button>
        </div>
        <div class="tool">
          <label>Brandbekämpfung (F):</label>
          <select id="fireSignSelect"></select>
          <button id="addFireSign">Hinzufügen</button>
        </div>
        <div class="tool">
          <label>Warnzeichen (W):</label>
          <select id="warnSignSelect"></select>
          <button id="addWarnSign">Hinzufügen</button>
        </div>
        <div class="tool">
          <label>Gebotszeichen (M):</label>
          <select id="mandSignSelect"></select>
          <button id="addMandSign">Hinzufügen</button>
        </div>
      </div>
      <div class="row">
        <label><input type="checkbox" id="showNorth" checked /> Nordpfeil anzeigen</label>
        <label><input type="checkbox" id="showYouAreHere" checked /> „Sie sind hier“ anzeigen</label>
      </div>
    </section>

    <!-- 5) AI -->
    <section class="panel">
      <h2>5) AI‑Unterstützung</h2>
      <div class="row">
        <textarea id="siteContext" rows="4" placeholder="Bauabschnitt, Gefährdungen, Besucheranteil, besondere Anforderungen …"></textarea>
      </div>
      <div class="row">
        <button id="aiSuggestBtn">AI: Symbol‑/Layout‑Vorschläge</button>
        <button id="aiTextsBtn">AI: Verhaltensregeln (Brandfall/Unfall)</button>
      </div>
      <div class="row">
        <pre id="aiOutput" class="code"></pre>
      </div>
    </section>

    <!-- 6) Prüfung & Export -->
    <section class="panel">
      <h2>6) Prüfung & Export</h2>
      <div class="row export">
        <button id="validateBtn">DIN/ISO prüfen</button>
        <button id="exportSVG">SVG exportieren</button>
        <button id="exportPNG">PNG exportieren</button>
        <button id="exportPDF">PDF (Clientdruck A3)</button>
        <button id="exportPDFServer">PDF (Server, A3)</button>
      </div>
      <div class="row">
        <pre id="validationOutput" class="code"></pre>
      </div>
    </section>
  </main>

  <footer>
    <small>
      Hinweis: Gestaltung gemäß DIN ISO 23601; Sicherheitszeichen gemäß ISO 7010/ISO 3864. 
      Endfreigabe durch fachkundige Stelle im Unternehmen erforderlich.
    </small>
  </footer>

  <script src="./app.js"></script>
</body>
</html>
